<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
</head>
<body>
    <h1>Time:</h1>
    <h1>Time And Date:</h1>
    <p>
        date: <span id="y">0</span>-<span id="m">0</span>-<span id="d">0</span>
    </p>
    <p>
        hour: <span id="h">00</span> <span id="ampm">AM</span>
    </p>
    <h1>Demand:</h1>
    <h2>Province 1: </h2>
        <h3>Public Feeder: <span id="d1">0</span>MW</h3>  
        <h3>Industry Feeder: <span id="d11">0</span>MW</h3>
    <h2>Madhesh: 
        <h3>Public Feeder: <span id="d2">0</span>MW</h3>  
        <h3>Industry Feeder: <span id="d21">0</span>MW</h3>
    <h2>Bagmati: 
        <h3>Public Feeder: <span id="d3">0</span>MW</h3>  
        <h3>Industry Feeder: <span id="d31">0</span>MW</h3>
    <h2>Gandaki: 
        <h3>Public Feeder: <span id="d4">0</span>MW</h3>  
        <h3>Industry Feeder: <span id="d41">0</span>MW</h3>
    <h2>Lumbini: 
        <h3>Public Feeder: <span id="d5">0</span>MW</h3>  
        <h3>Industry Feeder: <span id="d51">0</span>MW</h3>
    <h2>Karnali: 
        <h3>Public Feeder: <span id="d6">0</span>MW</h3>  
        <h3>Industry Feeder: <span id="d61">0</span>MW</h3>
    <h2>Sudurpaschim: 
        <h3>Public Feeder: <span id="d7">0</span>MW</h3>  
        <h3>Industry Feeder: <span id="d71">0</span>MW</h3>

    <h1>Supply:</h1>
    <h2>Province 1: </h2>
        <h3>RoR: <span id="s1">0</span>MW</h3>  
        <h3>Stored: <span id="s11">0</span>MW</h3>
        <h3>PRoR: <span id="s12">0</span>MW</h3>
        <h3>Solar: <span id="s13">0</span>MW</h3>
    <h2>Madhesh: </h2>
        <h3>RoR: <span id="s2">0</span>MW</h3>  
        <h3>Stored: <span id="s21">0</span>MW</h3>
        <h3>PRoR: <span id="s22">0</span>MW</h3>
        <h3>Solar: <span id="s23">0</span>MW</h3>
    <h2>Bagmati: </h2>
        <h3>RoR: <span id="s3">0</span>MW</h3>  
        <h3>Stored: <span id="s31">0</span>MW</h3>
        <h3>PRoR: <span id="s32">0</span>MW</h3>
        <h3>Solar: <span id="s33">0</span>MW</h3>
    <h2>Gandaki: </h2>
        <h3>RoR: <span id="s4">0</span>MW</h3>  
        <h3>Stored: <span id="s41">0</span>MW</h3>
        <h3>PRoR: <span id="s42">0</span>MW</h3>
        <h3>Solar: <span id="s43">0</span>MW</h3>
    <h2>Lumbini: </h2>
        <h3>RoR: <span id="s5">0</span>MW</h3>  
        <h3>Stored: <span id="s51">0</span>MW</h3>
        <h3>PRoR: <span id="s52">0</span>MW</h3>
        <h3>Solar: <span id="s53">0</span>MW</h3>
    <h2>Karnali: </h2>
        <h3>RoR: <span id="s6">0</span>MW</h3>  
        <h3>Stored: <span id="s61">0</span>MW</h3>
        <h3>PRoR: <span id="s62">0</span>MW</h3>
        <h3>Solar: <span id="s63">0</span>MW</h3>
    <h2>Sudurpaschim: </h2>
        <h3>RoR: <span id="s7">0</span>MW</h3>  
        <h3>Stored: <span id="s71">0</span>MW</h3>
        <h3>PRoR: <span id="s72">0</span>MW</h3>
        <h3>Solar: <span id="s73">0</span>MW</h3>
    
</body>
<script>

    let c = 0

    function demand(){
        fetch('/demand')
        .then(r => r.json())
        .then(data => {
            if (data.error) return console.error(data.error);
            for (let a = 1; a <= 7; a++) {
                document.getElementById(`d${a}`).textContent  = data[`p${a}`].p;
                document.getElementById(`d${a}1`).textContent = data[`p${a}`].i;
            }
        }).catch(console.error);
    }

    function supply(){
        fetch('/supply')
        .then(r => r.json())
        .then(data =>{
            if (data.error) return console.error(data.error);
            for (let a = 1; a <= 7; a++) {
                document.getElementById(`s${a}`).textContent   = data[`p${a}`].RoR;
                document.getElementById(`s${a}1`).textContent  = data[`p${a}`].Storage;
                document.getElementById(`s${a}2`).textContent  = data[`p${a}`].PRoR;
                document.getElementById(`s${a}3`).textContent  = data[`p${a}`].Solar;
            }
        }).catch(console.error);
    }

    function time(){
        fetch("/time")
        .then(r => r.json())
        .then(data =>{
            if (data.error) return console.error(data.error);
            document.getElementById("y").textContent = data.date.y;
            document.getElementById("m").textContent = data.date.m;
            document.getElementById("d").textContent = data.date.d;

            const hour24 = data.time.h;
            const ampm = hour24 >= 12 ? "PM" : "AM";  
            let hour12 = hour24 % 12;
            if (hour12 === 0) hour12 = 12;
            document.getElementById("h").textContent = hour12.toString().padStart(2, "0");
            document.getElementById("ampm").textContent = ampm;
        }).catch(console.error);
    }

    function update(){
        time();
        if (c<20){
            time();
            c++
        }
        else{
            demand();
            supply();
            c = 0
        }
        
    }

    setInterval(update, 100);
    update();
</script>
</html>